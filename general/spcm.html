

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Spectrum Board installation &mdash; Python NCS tools 0.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Python NCS tools 0.2 documentation" href="../index.html" />
    <link rel="next" title="Troubleshooting" href="troubleshooting.html" />
    <link rel="prev" title="How to set up a setup" href="hardware_setup.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="troubleshooting.html" title="Troubleshooting"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="hardware_setup.html" title="How to set up a setup"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Python NCS tools 0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="spectrum-board-installation">
<h1>Spectrum Board installation<a class="headerlink" href="#spectrum-board-installation" title="Permalink to this headline">¶</a></h1>
<p>A digital acquisition board is installed on one of the NCS machines. This
board, named Spectrum after the producers name, can be used for the acquisition
of analog signals directly from the chips, giving the user the possibility to
integrate his experiments with a tool for the reading of non-AER signals. NCS
group has written an interface in Python and standard basic operation can now
be done from inside a python script just calling an executable.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The board is a Spectrum M2i.3132. It has 8 channels, 12bits. They can acquire simultaneously at 25MHZ max <a class="footnote-reference" href="#id2" id="id1">[1]</a>.</p>
<p>Drivers and software are provided for
Windows and a bunch of linux distributions and architectures. For zaex machine, we need the driver sources and compile the driver. The source code is <em>not</em>
distributed so we need a special permission in order to use (and eventually modify) their driver. Every programmer using the board has to sign an agreement saying
the usual things like &#8220;I will not re-ditribute the code... I will not use the code for making money...&#8221;. Something like this will work:</p>
<div class="highlight-python"><pre>Dear Bernd,
 I'm a PhD working at the Institute of Neuroinfomatics in Zurich with
 Giacomo Indiveri. We have an M2i.3132 installed and I need the driver
 source code because there is no build for our distribution and architecture
 (Ubuntu &lt;blabla&gt;, multicore SMP, &lt;blabla&gt;). I know I can sign a non-disclosure agreement,
 can you send it please?
 Thank you and best regards,
     Fabio Stefanini</pre>
</div>
<p>Easily speaking, the board itself is a minimal oscilloscope. It is much similar (in concept) to the hardware installed on other more expensive oscilloscopes
with nice LCD panels, buttons, controls, ... This one has a lot of advantages, over the obvious disadvantage represented by the performances: it is provided as
a PCI card to be installed on a computer. This means it can be used by scripts which eventually need to read analog signal and then perform some operation.
First example coming to your mind: auto-adjusting biases on a chip!</p>
<p>Since the company only gave us the driver, we needed to write our own interface, even because our very peculiar NCS-style purposes (interface with the chips).
A first attempt of having a complete interface to be integrated in a complex optimization algorithm was done by the writer and it is here documented.
At this Alpha stage, the C program is able to set board&#8217;s parameters (how many channels you want to use? Which range in voltages? Which signal should trigger
the acquisition? etc.) and perform an acquisition writing the output directly into a file.</p>
<table class="docutils citation" frame="void" id="q" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[q]</td><td>The main contact is &#8216;&#8217;Bernd.Toerner AT spec DOT de&#8217;&#8216;, &#8216;&#8217;Claudia.Boras AT spec DOT de&#8217;&#8217; was the girl
replying to my email, &#8216;&#8217;Matthias.Wilma AT spec DOT de&#8217;&#8217; is the contact for technical support.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>This is enough for acquiring signals from our chips. For example, with a samplerate of 25MHz you can clearly catch req/ack signals and trigger acquisition with them.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="installing-updating-the-board">
<h2>Installing/Updating the board<a class="headerlink" href="#installing-updating-the-board" title="Permalink to this headline">¶</a></h2>
<p>You can checkout all the code you need from <a class="reference external" href="https://svn.ini.uzh.ch/repos/avlsi/NCS/SW/spectrum/.">svn</a>. Here&#8217;s a short description of the important content you just downloaded:</p>
<blockquote>
<div><ul class="simple">
<li>examples: a set of examples programs in C provided by the company. They should easily work and I started from them writing the actual interface.</li>
<li>spcm_linuxkernel_source: the driver source!</li>
<li>ncspectrum: the programs for acquiring signals</li>
<li>m2i31_manual_english.pdf: the manual...</li>
</ul>
</div></blockquote>
<p>Now have the source code. It is good to update it from time to time. Go to the <a class="reference external" href="http://www.spec.de/driver_download.html">Spectrum&#8217;s website</a> for new software. For the latest new driver
you always have to ask them the source by email, though. Let&#8217;s see how to update the driver.</p>
<p>You need to be root sometimes to complete the operations(Actually you should be a member of SPCM group on ZAEX to have the right access!!). Ask zaex&#8217;s admins for that. To compile the drivers type:</p>
<div class="highlight-python"><pre>$ sudo su
# cd spcm_linuxkernel_source/m2i_krnl_linux
# make -f Makefile.kernel26</pre>
</div>
<p>The kernel module should be copied in the /lib/modules/<cite>uname -r</cite>/extras. Run a:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># sudo depmod</span>
</pre></div>
</div>
<p>to make sure the module list is updated. To load the module run:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># sudo modprobe spcm</span>
</pre></div>
</div>
<p>If modprobe does not work, try:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># sudo insmod /lib/modules/`uname -r`/extras/spcm.ko</span>
</pre></div>
</div>
<p>Check that the /dev/spcm0 node is created and check its permissions. If it has root permissions, it means udev rules didn&#8217;t work so always remember to run the programs that use the device as root. Trying to solve the udev problem is also a good idea.</p>
<p><em>TODO: fix udev problem (udev rule apply correct permissions to /dev/spcm0 but segfault is raised if you are not root!)</em></p>
</div>
<div class="section" id="spectrum-software">
<h2>Spectrum software<a class="headerlink" href="#spectrum-software" title="Permalink to this headline">¶</a></h2>
<p>From the company&#8217;s website you can download the latest software. The first one is the Spcm Control Center (spcm_control_center_v127b3459.tgz). It visualizes some
infos about the spcm card so you can use it in order to check that the board is really running. You can do also other unimportant stuff with it if you want.</p>
<p>An other cool and useful one is SBench6 (sbench6-6.0.06b3529-1.64bit_stdc++6.rpm). Install it by typing:</p>
<div class="highlight-python"><pre>$&gt; sudo rpm -Uvh sbench6-6.0.06b3529-1.64bit_stdc++6.rpm</pre>
</div>
<p>Once you do that you end up with a cool GUI which visualize signals in realtime. You can practice with it a bit. Just run it:</p>
<div class="highlight-python"><pre>$&gt; SBench6</pre>
</div>
<p>Normally, you first visualize the signals you are going to acquire and sets the parameters (ranges, offsets, ...), try some acquisition and test different
buffer lenghts and triggering and finally put everything in a python script and automatize the acquisition. The latter operation is a bit time consuming because
it require to write a lot of stuff. Since you can save the configuration file directly from the GUI, it would be nice to be able to read this signal from inside the
python script. Do you want to be the really first guy implementing this amazing feature? Be my guest then!</p>
<p>For saving the configuration just go to File &gt; Save config. It will save a txt file with a lot of stuff in it.</p>
<p>Please notice that the free version of SBench6 doesn&#8217;t allow ASCII save of data file. If you want an ASCII file with your data you can only use the C program <tt class="docutils literal"><span class="pre">rec_single_asciifile</span></tt>.</p>
</div>
<div class="section" id="common-problems">
<h2>Common problems<a class="headerlink" href="#common-problems" title="Permalink to this headline">¶</a></h2>
<div class="section" id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h3>
<p>Whenever something weird happens, is cool to have a trace of all the operations that have been done with the board.
Open the Spectrum Control Center and set the log level on the support tab to &#8220;log all, including library calls&#8221;.
Then close the Control Center and start your program.
Now all driver calls and further informations are stored in the file &#8220;spcmdrv_debug.txt&#8221;. If you want to contact the company, always send them this file.
It is also useful for debugging you program, obviously.</p>
</div>
<div class="section" id="the-system-doesn-t-find-the-board">
<h3>The system doesn&#8217;t find the board<a class="headerlink" href="#the-system-doesn-t-find-the-board" title="Permalink to this headline">¶</a></h3>
<p>It can be a problem of permission. Try running you command with <tt class="docutils literal"><span class="pre">sudo</span></tt>, for example:</p>
<div class="highlight-python"><pre>$&gt; sudo Sbench6</pre>
</div>
<p>If this works, it means the udev rule is not working properly setting the right permissions for <tt class="docutils literal"><span class="pre">/dev/spcm0</span></tt>. If it still doesn&#8217;t work
the problem is maybe hard to solve. First, check that <tt class="docutils literal"><span class="pre">/dev/spcm0</span></tt> is actually there, then try to remove the module and load it again:</p>
<div class="highlight-python"><pre>$&gt; sudo rmmod spcm
$&gt; ls /dev/spcm0
ls: cannot access /dev/spcm0: No such file or directory
$&gt; sudo modprobe spcm
$&gt; ls /dev/spcm0
/dev/spcm0</pre>
</div>
</div>
<div class="section" id="sbench6-keeps-crashing">
<h3>SBench6 keeps crashing<a class="headerlink" href="#sbench6-keeps-crashing" title="Permalink to this headline">¶</a></h3>
<p>Well... That&#8217;s why it is so useful to save a config file... If it crashes, just close it and open it again. Perhaps this is related to the &#8220;acquiring
zeros&#8221; problem. Who knows... You may want to contact the company.</p>
</div>
<div class="section" id="acquired-signals-are-all-0s">
<h3>Acquired signals are all 0s<a class="headerlink" href="#acquired-signals-are-all-0s" title="Permalink to this headline">¶</a></h3>
<p>This is a bug somewhere in the driver, most probably. Nobody really figured out how to solve it. A work-around is to set a smaller buffersize (under 2MB)
and/or decreasing the framerate and acquire again. Do you want to fix this problem? Be my guest!</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Spectrum Board installation</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#installing-updating-the-board">Installing/Updating the board</a></li>
<li><a class="reference internal" href="#spectrum-software">Spectrum software</a></li>
<li><a class="reference internal" href="#common-problems">Common problems</a><ul>
<li><a class="reference internal" href="#debugging">Debugging</a></li>
<li><a class="reference internal" href="#the-system-doesn-t-find-the-board">The system doesn&#8217;t find the board</a></li>
<li><a class="reference internal" href="#sbench6-keeps-crashing">SBench6 keeps crashing</a></li>
<li><a class="reference internal" href="#acquired-signals-are-all-0s">Acquired signals are all 0s</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="hardware_setup.html"
                        title="previous chapter">How to set up a setup</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="troubleshooting.html"
                        title="next chapter">Troubleshooting</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/general/spcm.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="troubleshooting.html" title="Troubleshooting"
             >next</a> |</li>
        <li class="right" >
          <a href="hardware_setup.html" title="How to set up a setup"
             >previous</a> |</li>
        <li><a href="../index.html">Python NCS tools 0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, University of Zurich, Emre Neftci, Sadique Sheik, Fabio Stefanini, Giacomo Indiveri.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>