

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The Python Oscilloscope Module &mdash; Python NCS tools 0.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Python NCS tools 0.2 documentation" href="../index.html" />
    <link rel="next" title="Doing real experiments" href="experiments.html" />
    <link rel="prev" title="Step by step tutorial" href="tutorial.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="experiments.html" title="Doing real experiments"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tutorial.html" title="Step by step tutorial"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Python NCS tools 0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-python-oscilloscope-module">
<h1>The Python Oscilloscope Module<a class="headerlink" href="#the-python-oscilloscope-module" title="Permalink to this headline">¶</a></h1>
<p>written on 2/12 2010 by <a class="reference external" href="mailto://andstein&#37;&#52;&#48;student&#46;ethz&#46;ch">Andreas Steiner</a></p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This package provides the <a class="reference external" href="api.html#module-pyOsc">Oscilloscope class</a> which actually is an abstraction wrapper
that can be used to access any oscilloscope-like device for which exists a &#8216;driver&#8217;. So far there is only a
driver provided for the <a class="reference external" href="api.html#module-pyOsc.spectrum">Spectrum Card</a> &#8211; Normally you wouldn&#8217;t care too
much about the actual drivers and only use the wrapper. Using a different oscilloscope then results in a simple
change of one line of code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyOsc.spectrum</span> <span class="kn">import</span> <span class="n">SpectrumCard</span> <span class="k">as</span> <span class="n">driver</span> <span class="c"># already implemented</span>
<span class="c"># from pyOsc.agilent import AgilentEthernetController as driver # not yet implemented !</span>

<span class="kn">import</span> <span class="nn">pyOsc</span>
<span class="n">osc</span><span class="o">=</span> <span class="n">pyOsc</span><span class="o">.</span><span class="n">Oscilloscope</span><span class="p">(</span> <span class="n">driver</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h2>
<div class="section" id="initializing">
<h3>Initializing<a class="headerlink" href="#initializing" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s assume we are connected via <tt class="docutils literal"><span class="pre">ssh</span></tt> to <tt class="docutils literal"><span class="pre">zaex</span></tt> where the <tt class="docutils literal"><span class="pre">SpectrumCard</span></tt> is currently installed and
let&#8217;s assume we have some single chip setup as described in the setup file
<a class="reference external" href="http://ncs.ethz.ch/ncs/internal/manuals-and-how-tos/experiments-with-ncs-vlsi-chips/zaex.xml">zaex.xml</a></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pyOsc</span><span class="o">,</span><span class="nn">pyNCS</span>
<span class="kn">from</span> <span class="nn">pyOsc.spectrum</span> <span class="kn">import</span> <span class="n">SpectrumCard</span> <span class="k">as</span> <span class="n">driver</span> <span class="c"># already implemented</span>
<span class="n">osc</span><span class="o">=</span> <span class="n">pyOsc</span><span class="o">.</span><span class="n">Oscilloscope</span><span class="p">(</span> <span class="n">driver</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="p">)</span>
<span class="n">basedir</span> <span class="o">=</span> <span class="s">&#39;/home/federico/pyFED/&#39;</span>
<span class="n">setup</span> <span class="o">=</span> <span class="n">pyNCS</span><span class="o">.</span><span class="n">NeuroSetup</span><span class="p">(</span><span class="n">basedir</span><span class="o">+</span><span class="s">&#39;setups/mc_setuptype.xml&#39;</span><span class="p">,</span><span class="n">basedir</span><span class="o">+</span><span class="s">&#39;setups/mc.xml&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The spectrum card has 8 channels. As of the time of writing this tutorial, we have them connected to the
<tt class="docutils literal"><span class="pre">ifslwta</span></tt> chip in a particular way. In order to avoid confusing the lines and signals, we can label
the channels like this</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">osc</span><span class="o">.</span><span class="n">names</span><span class="p">(</span> <span class="p">{</span>
<span class="mi">0</span> <span class="p">:</span> <span class="s">&#39;Vmem127&#39;</span><span class="p">,</span>
<span class="mi">1</span> <span class="p">:</span> <span class="s">&#39;Vsyn (&quot;Vpls&quot;)&#39;</span><span class="p">,</span>
<span class="mi">2</span> <span class="p">:</span> <span class="s">&#39;Vpls (&quot;Vsyn&quot;)&#39;</span><span class="p">,</span>
<span class="mi">3</span> <span class="p">:</span> <span class="s">&#39;VsynAER&#39;</span><span class="p">,</span>
<span class="mi">4</span> <span class="p">:</span> <span class="s">&#39;VplsAER&#39;</span><span class="p">,</span>
<span class="mi">5</span> <span class="p">:</span> <span class="s">&#39;Vk&#39;</span><span class="p">,</span>
<span class="mi">6</span> <span class="p">:</span> <span class="s">&#39;Vwstd&#39;</span><span class="p">,</span>
<span class="mi">7</span> <span class="p">:</span> <span class="s">&#39;Vmem (scanner)&#39;</span> <span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-some-data">
<h3>Getting some data<a class="headerlink" href="#getting-some-data" title="Permalink to this headline">¶</a></h3>
<p>In the simplest scenario, we inject some current, set the scanner to any neuron, setup the channels and
just start recording</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">osc</span><span class="o">.</span><span class="n">channels</span><span class="p">(</span> <span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="p">)</span> <span class="c"># activate only 1 channel</span>
<span class="n">osc</span><span class="o">.</span><span class="n">ranges</span><span class="p">(</span> <span class="p">{</span><span class="mi">7</span><span class="p">:</span><span class="mi">1000</span><span class="p">}</span> <span class="p">)</span> <span class="c"># set the range to (-1000mV) to (1000mV)</span>
<span class="n">osc</span><span class="o">.</span><span class="n">sr</span><span class="p">(</span> <span class="mi">1024</span> <span class="p">)</span> <span class="c"># sample rate in Hertz</span>
<span class="n">setup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;ifslwta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">pinj</span><span class="o">.</span><span class="n">v</span><span class="o">=</span> <span class="mf">2.87</span> <span class="c"># inject some current into all neurons</span>
</pre></div>
</div>
<p>We know that all the neurons are firing more or less continuously due to the injection current. We would
like to acquire 5 seconds of data. The whole process of data acquiring is completely asynchronous, so we
have to tell the oscilloscope how much data we would like and then we need to wait until the oscilloscope
is ready:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">samples</span><span class="o">=</span> <span class="mi">5</span><span class="o">*</span> <span class="n">osc</span><span class="o">.</span><span class="n">sr</span><span class="p">()</span>
<span class="n">osc</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">samples</span> <span class="p">)</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">osc</span><span class="o">.</span><span class="n">done</span><span class="p">():</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>When we got so far, the whole data is acquired and can be found on the oscilloscope. In order to process
it in python scripts, we need first to transfer it to the computer memory. This is done by</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span><span class="o">=</span> <span class="n">osc</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
</pre></div>
</div>
<p>The data is now contained in raw format in the dictionary <tt class="docutils literal"><span class="pre">data</span></tt>. The keys to the dictionary are the
channel numbers and the samples are of type <tt class="docutils literal"><span class="pre">numpy.int16</span></tt> (for the spectrumcard, other drivers may
specify different sample types).</p>
</div>
<div class="section" id="visualizing-the-data">
<h3>Visualizing the data<a class="headerlink" href="#visualizing-the-data" title="Permalink to this headline">¶</a></h3>
<p>Simply type</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">osc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="c">#pop up plot</span>
</pre></div>
</div>
<p>This should result in a plot similar to the following</p>
<div class="figure align-center">
<img alt="raw data from oscilloscope" src="../_images/raw_data.png" style="width: 627px;" />
</div>
<p>If you want to display the data in millivolt and milliseconds instead of samples, simply type</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">osc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">osc</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-a-trigger">
<h3>Setting a trigger<a class="headerlink" href="#setting-a-trigger" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s suppose we want to have a nice picture of the spiking neuron. You can easily see in the figure
above that the different spikes are not exactly the same, so let&#8217;s take the average over several cycles
to get a smoother and more representative image.</p>
<p>In order to do this we will set a trigger on the sharp falling edge of the membrane potential and center
the data around that trigger. Let&#8217;s first precisely determine the point we want to trigger at. For this
purpose I use the normalized data plot from above, zoom a little bit closer and move my mouse cursor to
the point I want to trigger at:</p>
<div class="figure align-center">
<img alt="raw data from oscilloscope" src="../_images/normalized_data_zoomed.png" style="width: 649px;" />
</div>
<p>Ok. What we want is the following</p>
<ul class="simple">
<li>Trigger on the falling edge at 138 mV (on channel 7).</li>
<li>Record 200ms on every trigger.</li>
<li>Center the falling edge at 20% of these 200ms.</li>
<li>Collect 10 &#8216;rounds&#8217; of data.</li>
</ul>
<p>This translates into the following code</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">osc</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span><span class="mi">138</span><span class="p">,</span><span class="n">offset</span><span class="o">=.</span><span class="mi">2</span> <span class="p">)</span>
<span class="n">samples</span><span class="o">=</span> <span class="n">osc</span><span class="o">.</span><span class="n">sr</span><span class="p">()</span> <span class="o">*</span> <span class="o">.</span><span class="mi">2</span>
<span class="n">osc</span><span class="o">.</span><span class="n">rounds</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>
</div>
<p>As above, we start the data acquisition, wait for the oscilloscope to be ready and transfer the data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">osc</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">samples</span> <span class="p">)</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">osc</span><span class="o">.</span><span class="n">done</span><span class="p">():</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data</span><span class="o">=</span> <span class="n">osc</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
</pre></div>
</div>
<p>The raw plott looks pretty confusing, because we the different rounds are just concatenated one after
the other in the sample data. That&#8217;s why we let the oscilloscope wrapper plot markings between the rounds
and indicate the trigger level with a red line</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">osc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span><span class="n">decorate</span><span class="o">=</span><span class="bp">True</span> <span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="raw data from oscilloscope" src="../_images/decorated_data.png" style="width: 649px;" />
</div>
<p>We can now calculate our smooth plot by averaging the rounds. There&#8217;s a convinience method in <tt class="docutils literal"><span class="pre">Oscilloscope</span></tt>
to do this</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">average</span><span class="o">=</span> <span class="n">osc</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">osc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">osc</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span> <span class="n">average</span> <span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="feedback">
<h3>Feedback<a class="headerlink" href="#feedback" title="Permalink to this headline">¶</a></h3>
<p>If you found this tutorial useful or if you have any questions or if things did not work out
the way they are supposed to, you can always <a class="reference external" href="mailto://andstein&#37;&#52;&#48;student&#46;ethz&#46;ch">send me an email</a></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The Python Oscilloscope Module</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#tutorial">Tutorial</a><ul>
<li><a class="reference internal" href="#initializing">Initializing</a></li>
<li><a class="reference internal" href="#getting-some-data">Getting some data</a></li>
<li><a class="reference internal" href="#visualizing-the-data">Visualizing the data</a></li>
<li><a class="reference internal" href="#setting-a-trigger">Setting a trigger</a></li>
<li><a class="reference internal" href="#feedback">Feedback</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tutorial.html"
                        title="previous chapter">Step by step tutorial</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="experiments.html"
                        title="next chapter">Doing real experiments</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/general/pyosc.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="experiments.html" title="Doing real experiments"
             >next</a> |</li>
        <li class="right" >
          <a href="tutorial.html" title="Step by step tutorial"
             >previous</a> |</li>
        <li><a href="../index.html">Python NCS tools 0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009, Emre Neftci, Sadique Sheik, Daniel Sonnleithner, Giacomo Indiveri.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>